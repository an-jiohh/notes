분산락에 대한 정의부터 확인하자면 **여러 서버 또는 프로세스가 동일한 공유 자원에 접근할 때, 한 번에 하나의 주체만 자원을 사용할 수 있도록 제어하는 메커니즘**이다.

## 왜 분산락인가

실무환경에서는 단일서버로 운영하기 어려운 부분이있다.

- 서버하나가 죽을 경우 서비스의 장애가 되게된다.
- 단일서버로 만 구성되어있을 경우 트래픽이 몰렸을때 스케일 아웃이 불가능하다.

이런 경우에는 Synchronized와 같은 스레드 차원에서의 락으로는 대처가 불가능하다.  
연관되지않은 서버에서의 락이 걸리지 않기 때문이다.  

이때 필요한 것이 **분산락**이다.

---

## 분산락의 종류

크게 다음과 같은 항목으로 작성하고자 한다.

DB를 활용(락 방식에 대한 개념으로 이렇게 분류하는게 맞는가 싶다.)
- [[Unique index]]
- 비관락(Pessimistic Lock)
- 낙관락(Optimistic Lock)
- 네임드락(Named Lock)

Redis를 활용
- lettuce
- redisson

Zookeeper를 활용

아래로 내려갈 수록 구축비용이 비싼 분산락이다.  
그렇다면 어떠한 경우에 각각의 경우의 수를 써야할까?  

가장 추가적인 인프라 추가없이 쓸 수 있는 DB로 부터 시작해보자. 

트랜잭션 고립 수준을 이용하면 굳이 분산락이 필요할까? 
-> 레벨에 따라 일어날 수 있는 문제점이 존재(성능, 트랜잭션 경계 밖 충돌) = 해당 부분은 추후 정리

결론 DB가 여러대 있을 경우 문제가 발생한다.  
= 분산환경의 데이터베이스에서는 완전히 보장하는데 한계가있다

그렇다면 Redis를 사용하면 문제가 없을까?  
규모가 커져서 Redis도 여러대를 사용하게 된다면?  

Redis로도 모든 것을 해결할 수 없다.  
redisson 경우에도 완벽하지는 않다고 한다.  

100프로를 보장해야한다면 Zookeeper을 사용해야한다 정도로 넘어가고자 한다.  