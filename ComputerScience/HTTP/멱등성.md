# 멱등성


멱등성이란 , 동일한 요청을 여러번 보내더라도 결과가 한 번 수행한 것과 동일하게 보장되는 성질

예를 들어 DELETE /users/1 은 몇 번을 호출해도 사용자 1이 삭제된 채로 동일해야함.

사용자가 같은 요청을 반복하거나 네트워크 장애로 재시도가 발생해도 시스템의 최종 상태가 변하지 않도록 보장하는 것이 핵심 목적

---
## 멱등성이 요구되는 주요 영역

### 1. HTTP 메서드 설계

HTTP는 처음 설계 단계에서 정의된 스펙에 맞추어 설계가 되어야함

GET : 항상 멱등적이어야함 - 조회는 몇 번 해도 동일
PUT : 동일한 자원 업데이트 시, 같은 요청을 여러 번 보내도 최종 상태는 동일
DELETE : 이미 삭제된 자원에 다시 요청해도 결과는 삭제됨 상태
POST : 기본적으로 멱등하지 않지만, 결제 주문 같은 경우 서버가 별도 키를 부여하면 멱등성을 확보 가능

#### POST 멱등키를 활용한 멱등성 확보

[토스 페이먼츠 - 멱등성이 먼가요?](https://docs.tosspayments.com/blog/what-is-idempotency)

토스 기술블로그의 내용이 상세하게 나와있어 링크로 대체

### 2. 결제 시스템 및 주문 재고 처리

멱등성이 보장되지 않을 경우 크리티컬한 이슈가 발생할 수 있기 때문

### 3. 분산 시스템 & 메시징
RabbitMQ, Kafka 같은 메시지 브로커에서 메시지가 중복 소비될 수 있음  
-> 소비자가 멱등적으로 처리해야 중복 소비 시에도 데이터 불일치가 안 생김  
ex) 포인트 적립 이벤트 -> 같은 메시지가 두 번 와도 포인트가 두 번 오르지 않게 설계

### 4. Retry/재시도 메커니즘
- 네트워크 오류나 타임아웃 발생 시 클라가 요청을 재시도 할 수 있음.
- 이때 API가 멱등적이지 않으면, 같은 요청이 중복 처리되어 장애 발생
- ex) PUT /users/123/email 요청은 재시도해도 최종 상태는 동일해야 안전